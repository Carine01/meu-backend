name: Métricas Elevare

on:
  schedule:
    - cron: "*/15 * * * *"

jobs:
  metrics:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - uses: actions/checkout@v4

      - name: Coletar métricas
        run: |
          echo "$(date): $(curl -s --max-time 30 --fail http://${{ secrets.SERVER_IP }}:3000/health || echo 'ERROR: Unable to reach health endpoint')" >> metrics.log

      - name: Publicar métricas
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: .
          keep_files: true
          force_orphan: true
